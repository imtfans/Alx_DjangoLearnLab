{% extends "base.html" %}
{% block content %}
<article class="post">
  <h1>{{ post.title }}</h1>
  <p>By {{ post.author }} • {{ post.published_at }}</p>
  <div class="post-body">
    {{ post.body|linebreaks }}
  </div>
</article>

<section id="comments" class="mt-4">
  <h2>Comments ({{ comments|length }})</h2>

  {% if comments %}
    <ul class="list-unstyled">
      {% for comment in comments %}
        <li class="media my-3 p-3 border rounded">
          <div class="media-body">
            <strong>{{ comment.author }}</strong>
            <small class="text-muted"> — {{ comment.created_at|date:"M d, Y H:i" }}{% if comment.updated_at and comment.updated_at > comment.created_at %} (edited){% endif %}</small>
            <p class="mb-1">{{ comment.content|linebreaksbr }}</p>

            {% if user.is_authenticated and comment.author == user %}
              <div class="comment-actions">
                <a href="{% url 'blog:comment_edit' comment.pk %}">Edit</a> |
                <a href="{% url 'blog:comment_delete' comment.pk %}">Delete</a>
              </div>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No comments yet. Be the first to comment.</p>
  {% endif %}
</section>

<section id="add-comment" class="mt-4">
  {% if user.is_authenticated %}
    <h3>Add a comment</h3>
    <form action="{% url 'blog:comment_create' post.pk %}" method="post">
      {% csrf_token %}
      {{ comment_form.non_field_errors }}
      <div class="form-group">
        {{ comment_form.content }}
        {% for error in comment_form.content.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>
      <button type="submit" class="btn btn-primary">Post Comment</button>
    </form>
  {% else %}
    <p><a href="{% url 'login' %}?next={{ request.path }}">Sign in</a> to post a comment.</p>
  {% endif %}
</section>
{% endblock content %}
